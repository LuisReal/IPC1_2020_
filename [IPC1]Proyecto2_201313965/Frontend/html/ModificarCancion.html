<html>

<head>
    <link href="../css/ModificarCancion.css" rel="stylesheet">
    <link href="../css/navbar.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<script>
    if (!sessionStorage.usuario) {
            window.location.href = "../index.html";
        }
</script>
<body onload="cargarInfo(), mostrarPerfil()">

    <div class="global-container">
        <button id="btn-open-menu" class="btn-open-navbar"><i class="bi bi-list"></i></button>

        <div class="banner-izquierdo" id="banner-izquierdo">

            <button id="btn-close-menu" class="btn-close-navbar"><i class="bi bi-x-square"></i></button>
            <label class="foto-perfil"></label>
            

            <div class="botones-container">

                <h1 id="nombre-usuario" class="nombre-usuario"></h1>
                
                <button onclick="Back()" type="button" class="btn-pagina-principal">Pagina Principal</button>
                <button onclick="perfil()" type="button" class="btn-mi-perfil">Mi Perfil</button>
                <button type="button" onclick="back()" class="boton-back">Back</button>
            </div>
            <button href="javascript:cerrar()" onclick="cerrarSesion()" type="button" class="boton-cerrarSesion">Cerrar
                Sesion</button>
        </div>

        <div class="info-container">
            <div class="datos-usuario">
                <p>Datos De La Cancion Seleccionada</p>

                <label class="label-nombre">Nombre</label>
                <input class="input-nombre" id="Nombre">

                <label class="label-artista">Artista</label>
                <input class="input-artista" id="Artista">

                <label class="label-album">Album</label>
                <input class="input-album" id="Album">

                <label class="label-fecha">Fecha</label>
                <input class="input-fecha" id="Fecha">

                <label class="label-imagen">Imagen</label>
                <input class="input-imagen" id="Imagen">

                <label class="label-spotify">Spotify</label>
                <input class="input-spotify" id="Spotify">

                <label class="label-youtube">Youtube</label>
                <input class="input-youtube" id="Youtube">

                <div class="botones-usuario">
                    <button type="button" onclick="Modificar()" class="boton-modificar">Modificar</button>
                    <button type="button" onclick="Eliminar()" class="boton-eliminar">Eliminar</button>
                    <button type="button" onclick="Back()" class="boton-regresar">Regresar</button>
                </div>
                

            </div>


        </div>
    </div>



    <script>
        function back() {
            location.href = "administrador.html"
        }
        function Back() {
            location.href = "administrador.html"
        }
        function perfil() {
            location.href = "ModificarPerfilAdministrador.html"
        }
    </script>

    <script>

        
        function mostrarPerfil() {

            fetch('http://3.150.236.120:8000/Admin',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)


                var valor = res.admin // Proviene de ModificarPerfilAdministrador.html (Modificar()) 

                var h1 = document.querySelector('#nombre-usuario')
                h1.innerHTML +=
                    `
                            <h1>${valor}</h1>
                            
                            `
            })

        }

        function cargarInfo() {

            var id = sessionStorage.buscar // la clave buscar que guarda el id de la cancion proviene de administrador.html // mostrarPerfil


            fetch(`http://3.150.236.120:8000/Canciones/${id}`, // proviene de administrador.html  y por defecto el metodo es GET

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)


                document.querySelector('#Nombre').value = res.nombre
                document.querySelector('#Artista').value = res.artista
                document.querySelector('#Album').value = res.album
                document.querySelector('#Fecha').value = res.fecha
                document.querySelector('#Imagen').value = res.imagen
                document.querySelector('#Spotify').value = res.spotify
                document.querySelector('#Youtube').value = res.youtube

            })
        }

        function Modificar() {
            var id = sessionStorage.buscar
            var nombre = document.querySelector('#Nombre').value
            var artista = document.querySelector('#Artista').value
            var album = document.querySelector('#Album').value
            var fecha = document.querySelector('#Fecha').value
            var imagen = document.querySelector('#Imagen').value
            var spotify = document.querySelector('#Spotify').value
            var youtube = document.querySelector('#Youtube').value
            var objeto = {
                'nombre': nombre,
                'artista': artista,
                'album': album,
                'fecha': fecha,
                'imagen': imagen,
                'spotify': spotify,
                'youtube': youtube
            }

            fetch(`http://3.150.236.120:8000/Canciones/${id}`, {


                method: 'PUT',
                body: JSON.stringify(objeto),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res.message)

                alert("La cancion fue modificada exitosamente")
                location.href = "administrador.html"

            })
        }

        function Eliminar() {

            var nombre = document.querySelector('#Nombre').value


            var objeto = {
                'nombre': nombre

            }

            fetch(`http://3.150.236.120:8000/Canciones/${nombre}`, {


                method: 'DELETE',
                body: JSON.stringify(objeto),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res.message)

                alert("La Cancion fue eliminada exitosamente")
                location.href = "administrador.html"
                //document.location.reload();
            })
        }


    </script>
    <script>
        const open_menu = document.getElementById("btn-open-menu");
        const close_menu = document.getElementById("btn-close-menu");
        const navbar = document.getElementById("banner-izquierdo");

        
            open_menu.addEventListener("click", () => {
                console.log("hiciste click en abrir menu");
                navbar.classList.add("visible");
            });

            close_menu.addEventListener("click", () => {
                console.log("hiciste click en cerrar menu");
                navbar.classList.remove("visible");
            });
        
    </script>
</body>

</html>