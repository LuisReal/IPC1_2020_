<html>

<head>

    <link href="../css/DetallesCancion.css" rel="stylesheet">
    <link href="../css/navbar.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body onload="mostrarCliente(), verImagen(), verVideo(), verComentarios()">

    <div class="global-container">
        <button id="btn-open-menu" class="btn-open-navbar"><i class="bi bi-list"></i></button>

        <div class="banner-izquierdo" id="banner-izquierdo">

            <button id="btn-close-menu" class="btn-close-navbar"><i class="bi bi-x-square"></i></button>

            <label class="foto-perfil"></label>
            

            <div class="botones-container">

                <h1 id="usuario" class="nombre-usuario"></h1>
                
                <button onclick="Principal()" type="button" class="btn-pagina-principal">Pagina Principal</button>
                <button onclick="miPerfil()" type="button" class="btn-mi-perfil">Mi Perfil</button>
                <button onclick="miPlayList()" type="button" id="playlist" onclick="" class="btn-playlist">Mi
                    PlayList</button>
                <button onclick="back()" type="button" class="boton-back">Back</button>

            </div>
            <button href="javascript:cerrar()" onclick="cerrarSesion()" type="button" class="boton-cerrarSesion">Cerrar
                Sesion</button>
        </div>

        <div class="info-container">

            <p class="p-tablacanciones">Informacion de la Cancion</p>

            <audio style="outline: none; width:100%" id="audio-cancion" autoplay  controls ></audio>
            <div class="comments-container">

                <div class="image-comment-container">
                    <div id="div-imagen" class="div-imagen">


                    </div>

                    <div class="div-comentario">
                        <label id="etiqueta" for="" class="label-comentario">Comentario:</label>
                        <textarea id="text" class="text-area"></textarea>
                        <button type="button" onclick="crearComentario()" class="btn-comentario">Guardar</button>

                    </div>
                </div>




                <div id="div-video" class="div-video">

                </div>

                <div id="div-comentarios" class="div-comentarios">

                </div>
            </div>


        </div>
    </div>



    <script>

        function back() {
            location.href = "Cliente.html"
        }

        function Principal() {
            location.href = "Cliente.html"
        }


        function miPerfil() {
            location.href = "ModificarPerfilCliente.html"
        }

        function miPlayList() {
            location.href = "PlayList.html"
        }

        function verImagen() {

            var detalles = sessionStorage.detalles

            fetch('http://3.150.236.120:8000/Canciones',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)

                for (i = 0; i < (res.length); i++) {
                    if (res[i].id == detalles) {
                        console.log(res[i])
                        var imagen = document.querySelector('#div-imagen')
                        imagen.innerHTML +=
                            `
                            <img style="margin-left: 0" src="${res[i].imagen}" width="340" height="340">
                            <label style="left:10px">${res[i].nombre}</label>
                            `
                    }
                }
            })
        }

        function verVideo() {

            var detalles = sessionStorage.detalles // contiene el id

            fetch('http://3.150.236.120:8000/Canciones',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)

                for (i = 0; i < (res.length); i++) {
                    if (res[i].id == detalles) {
                        console.log(res[i])
                        var video = document.querySelector('#div-video')
                        
                        var audio = document.querySelector('#audio-cancion')
                        var ruta = res[i].audio;
                        var ruta = ruta.slice(0, -1);
                        audio.src = ruta;
                        
                        console.log(`EL NOMBRE DE LA CANCION ES:  ${ruta}`);
                        video.innerHTML +=
                            `
                                <iframe src="${res[i].youtube}" width="100%" height="300" title="YouTube video player" frameborder="0" allowtransparency="true" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                                <label style=" left:10px">Nombre: ${res[i].nombre}</label>
                                <label style=" left:10px">Artista: ${res[i].artista}</label>
                                <label style=" left:10px">Album: ${res[i].album}</label>
                                <label style="left:10px">Fecha de Lanzamiento: ${res[i].fecha}</label>
                                
                                `
                    }
                }
            })
        }

        function verComentarios() {

            var id = sessionStorage.detalles // contiene el id


            fetch(`http://3.150.236.120:8000/Comentarios/${id}`,

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)

                for (i = 0; i < (res.length); i++) {

                    console.log(res[i])
                    var video = document.querySelector('#div-comentarios')
                    video.innerHTML +=
                        `
                            <div class="simple-comment">
                                <label style=" top: ${i * 20}px; left: 20px; height:30px; 
                                width:100px" class="">${res[i].usuario}:</label>
                                <label style=" top: ${i * 20}px; left: 120px; height:30px; 
                                width: 300px" class="">${res[i].comentario}</label>
                            </div>
                            
                            
                            `

                }
            })
        }
        function mostrarCliente() {
            fetch('http://3.150.236.120:8000/Usuarios',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)
                for (i = 0; i < (res.length); i++) {
                    console.log(res[i])
                    var valor = sessionStorage.usuario // proviene de inicio.html (valor=username)
                    if (res[i].Usuario == valor) {
                        var h1 = document.querySelector('#usuario')
                        h1.innerHTML +=
                            `

                            <h1 >${valor}</h1>
                            `
                    }
                }
            })
        }

        function crearComentario() {
            // se recive el id de la cancion seleccionada
            var id = sessionStorage.detalles // proviene de Cliente.html (verDetalles)
            var usuario = sessionStorage.usuario

            console.log("el usuario es: " + usuario + " y el id: " + id)

            var comentario = document.querySelector('#text').value

            var objeto = {
                'comentario': comentario,
                'usuario': usuario
            }

            fetch(`http://3.150.236.120:8000/Comentarios/${id}`, {


                method: 'POST',
                body: JSON.stringify(objeto),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()
            ).catch(err => {
                console.log(err)
            }).then(res => {
                console.log(res.message)

                alert(res.reason)
                document.location.reload();

            })

        }


    </script>
    <script>
        const open_menu = document.getElementById("btn-open-menu");
        const close_menu = document.getElementById("btn-close-menu");
        const navbar = document.getElementById("banner-izquierdo");


        open_menu.addEventListener("click", () => {
            console.log("hiciste click en abrir menu");
            navbar.classList.add("visible");
        });

        close_menu.addEventListener("click", () => {
            console.log("hiciste click en cerrar menu");
            navbar.classList.remove("visible");
        });

    </script>
</body>

</html>