<html>

<head>
    <script>
        window.onload = function() {
            
            if (!localStorage.getItem('usuario')) {
                
                window.location.href = "../index.html";
            }

            mostrarCliente(); 
            mostrarCanciones();
        };
    </script>

    <link href="../css/Cliente.css" rel="stylesheet">
    <link href="../css/navbar.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
</head>

<body>

    <div class="global-container">

        <button id="btn-open-menu" class="btn-open-navbar"><i class="bi bi-list"></i></button>

        <div class="banner-izquierdo" id="banner-izquierdo">

            <button id="btn-close-menu" class="btn-close-navbar"><i class="bi bi-x-square"></i></button>

            <label class="foto-perfil"></label>
            

            <div class="botones-container">

                <h1 id="usuario" class="nombre-usuario"></h1>
                
                <button onclick="" type="button" class="btn-pagina-principal">Pagina Principal</button>
                <button onclick="miPerfil()" type="button" class="btn-mi-perfil">Mi Perfil</button>
                <button type="button" id="playlist" onclick="miPlayList()" class="btn-playlist">Mi PlayList</button>
                <button type="button" id="solicitar" onclick="solicitar()" class="btn-solicitar">Solicitar
                    Cancion</button>
                <button onclick="back()" type="button" class="boton-back">Back</button>
                
            </div>
            <button href="javascript:cerrar()" onclick="cerrarSesion()" type="button" class="boton-cerrarSesion">Cerrar
                Sesion</button>

        </div>

        <div class="info-container">

           
            <p class="p-tablacanciones">Canciones Disponibles</p>

            <table>
                <thead>
                    <tr>

                    </tr>
                </thead>
                <tbody id="tbody">

                </tbody>
            </table>

        </div>
    </div>


    <script>
        

        function back() {
            location.href = "../index.html"
        }

        function miPerfil() {
            location.href = "ModificarPerfilCliente.html"
        }

        function cerrarSesion() {
            localStorage.removeItem('usuario');
            location.href = "../index.html"
        }

        function solicitar() {
            location.href = "Solicitar.html"
        }

        function miPlayList() {
            location.href = "PlayList.html"
        }

        function mostrarCanciones() {
            fetch('http://3.150.236.120:8000/Canciones',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)

                for (i = 0; i < (res.length); i++) {
                    console.log(res[i])
                    var body = document.querySelector('#tbody')
                    body.innerHTML +=
                        `
                        
                            
                            <td><iframe src="${res[i].spotify}" width="300" height="330" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
                                <p>${res[i].id} ${res[i].nombre} ${res[i].artista}</p>
                                <button type="button" value="${res[i].id}"  onclick="verDetalles(this)" class="ver-detalles">Ver Detalles</button>
                            <button onclick="addPlayList(this)"  type="button" value="${res[i].id}" class="add-to-playlist">Add to PlayList</button></td>
                            
                        
                        `
                }
            })
        }

        function addPlayList(boton) {
            var id = boton.value // se guarda el id de la cancion seleccionada
            var id_usuario = localStorage.usuario
            localStorage.setItem("id", id)

            var objeto = {
                'id': id,
                'id_usuario': id_usuario
            }

            fetch(`http://3.150.236.120:8000/CrearPlayList/${id}`, {


                method: 'POST',
                body: JSON.stringify(objeto),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()
            ).catch(err => {
                console.error(err)
            }).then(res => {
                console.log(res.message)

                alert(res.reason)


            })


        }

        function verDetalles(boton) {
            var detalles = boton.value // se guarda el id de la cancion seleccionada
            localStorage.setItem("detalles", detalles) // se envia a DetallesCancion.html (guarda el id al presionar boton)
            //sessionStorage.setItem("mostrar", detalles)
            location.href = "DetallesCancion.html"
        }



        function mostrarCliente() {
            fetch('http://3.150.236.120:8000/Usuarios',

            ).then(response => response.json()
            ).catch(err => {
                console.log("no se pudo consumir la api")
            }).then(res => {
                console.log(res)

                for (i = 0; i < (res.length); i++) {
                    console.log(res[i])
                    var valor = localStorage.usuario // .usuario proviene de inicio.html (valor=username)

                    if (res[i].Usuario == valor) {
                        var h1 = document.querySelector('#usuario')
                        h1.innerHTML +=
                            `

                        <h1>${valor}</h1>
                        `
                    }
                }
            })
        }
    </script>
    <script>
        const open_menu = document.getElementById("btn-open-menu");
        const close_menu = document.getElementById("btn-close-menu");
        const navbar = document.getElementById("banner-izquierdo");


        open_menu.addEventListener("click", () => {
            console.log("hiciste click en abrir menu");
            navbar.classList.add("visible");
        });

        close_menu.addEventListener("click", () => {
            console.log("hiciste click en cerrar menu");
            navbar.classList.remove("visible");
        });

    </script>


</body>

</html>